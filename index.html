<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>My Server</title>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/button.css">
    <link rel="stylesheet" href="css/month.css">
</head>
<body>
    <header class="header-container">
        <div class="left-section"></div>
        <div class="right-section">
            <button class="search-button"></button>
            <button class="event-add-button"></button>
        </div>
    </header>
    <main class="main-container">
        <div class="year-display"><p id="yearText">2025年</p></div>
        <div class="month-display">
            <div class="month-main" id="calendar"></div>
        </div>
    </main>
    <footer class="footer-container">
        <div class="left-section">
            <button class="today-button">今日</button>
        </div>
        <div class="right-section">
            <p class="version">© 2025 My Server. All rights reserved.</p>
        </div>
    </footer>
<script>
const calendarEl = document.getElementById("calendar");
let year = 2025;

/*
 * ------------------------------------------------------------------
 * 年度に合わせて1月～12月のテーブルの作成
 * @param {number} year 年度
 * 
 * @return なし
 * ------------------------------------------------------------------
 */
function createYearCalendar(year) {
    for (let month = 0; month < 12; month++) {
        const monthContainer = document.createElement("div");
        monthContainer.className = "month-container";

        // 月ラベル
        const monthLabel = document.createElement("div");
        monthLabel.className = "month-label";
        monthLabel.innerHTML = `<p>${month + 1}月</p>`;

        /**
         * 日付テーブル作成開始
         */        
        const table = document.createElement("table");
        table.className = "day-table";
        const firstDay = new Date(year, month, 1).getDay(); // 曜日
        const lastDate = new Date(year, month + 1, 0).getDate(); // 日数
        let date = 1;
        // 行数　6行固定
        for (let row = 0; row < 6; row++) {
            const tr = document.createElement("tr");

            for (let col = 0; col < 7; col++) {
                const td = document.createElement("td");

                if (row === 0 && col < firstDay) {
                    td.textContent = "";
                } else if (date > lastDate) {
                    td.textContent = "";
                } else {
                    td.textContent = date;
                    date++;
                }

                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
        /**
         * 日付テーブル作成終了
         */

        /**
         * 月 →　日付　の　順で作成
         */
        monthContainer.appendChild(monthLabel);
        monthContainer.appendChild(table);
        calendarEl.appendChild(monthContainer);
    }
}

/*
 * ------------------------------------------------------------------
 * 　年号変換処理開始
 * ------------------------------------------------------------------
 */
/**
 * 年減算処理
 */
function onYearUp() {
    updateYear(year-1);
}
/**
 * 年加算処理
 */
function onYearDown() {
    updateYear(year+1);
}
/**
 * 表示されている年月をリセット処理
 */
function clearCalendar() {
    calendarEl.innerHTML = "";
}
/**
 * 表示されている年の更新処理
 * @param {newyear} 更新する年号
 */
function updateYear(newYear) {
    year = newYear;
    document.getElementById("yearText").textContent = `${year}年`;
    clearCalendar();
    createYearCalendar(year);
}

/**
 * タッチ処理
 */
const container = document.querySelector(".month-display");
// タッチ位置保持
let startY = 0;
let startX = 0;

// スワイプ判定用：ポインター押下時の開始座標を保持
container.addEventListener("pointerdown", (e) => {
    startY = e.clientY;
    startX = e.clientX;
});

container.addEventListener("pointerup", (e) => {
    const endY = e.clientY;
    const endX = e.clientX;

    const diffY = endY - startY;
    const diffX = endX - startX;

    // 少しの動きは無視（誤動作防止）
    if (Math.abs(diffY) < 50) return;

    // 縦方向の動きがメインのときだけ反応
    if (Math.abs(diffY) > Math.abs(diffX)) {
        if (diffY < 0) {
            // 上スワイプ → 年を減らす
            onYearUp();
        } else {
            // 下スワイプ → 年を増やす
            onYearDown();
        }
    }
});
/*
 * ------------------------------------------------------------------
 * 　年号変換処理終了
 * ------------------------------------------------------------------
 */
// 初期処理　本年度を処理
createYearCalendar(year);
</script>
</body>
</html>
